<?xml version="1.0" encoding="UTF-8"?>
<configuration packagingData="true">
  <timestamp key="timestamp" datePattern="yyyy-MM-dd-HH-mm-ssSSS"/>

  <springProperty name="AWS_LOG_GROUP_NAME" source="aws.cloud-watch.log-group-name"/>
  <springProperty name="AWS_LOG_STREAM_NAME" source="aws.cloud-watch.log-stream-name"/>
  <springProperty name="AWS_REGION" source="aws.cloud-watch.region"/>
  <springProperty name="AWS_ACCESS_KEY" source="aws.cloud-watch.access-key"/>
  <springProperty name="AWS_SECRET_KEY" source="aws.cloud-watch.secret-key"/>

  <appender name="aws_cloud_watch_log" class="ca.pjer.logback.AwsLogsAppender">
    <layout>
      <pattern>[%thread] [%date] [%level] [%file:%line] - %msg%n</pattern>
    </layout>
    <logGroupName>${AWS_LOG_GROUP_NAME}</logGroupName>
    <logStreamUuidPrefix>${AWS_LOG_STREAM_NAME}</logStreamUuidPrefix>
    <logRegion>${AWS_REGION}</logRegion>
    <maxBatchLogEvents>50</maxBatchLogEvents>
    <maxFlushTimeMillis>30000</maxFlushTimeMillis>
    <maxBlockTimeMillis>5000</maxBlockTimeMillis>
    <retentionTimeDays>0</retentionTimeDays>
    <accessKeyId>${AWS_ACCESS_KEY}</accessKeyId>ê²½
    <secretAccessKey>${AWS_SECRET_KEY}</secretAccessKey>
  </appender>

  <property name="CONSOLE_LOG_PATTERN"
    value="%highlight(%-5level) %date [%thread] %cyan([%C{0} :: %M :: %L]) - %msg%n"/>
  
  <appender name="console_log" class="ch.qos.logback.core.ConsoleAppender">
    <encoder class="ch.qos.logback.classic.encoder.PatternLayoutEncoder">
      <pattern>${CONSOLE_LOG_PATTERN}</pattern>
    </encoder>
  </appender>

  <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
    <layout class="ch.qos.logback.classic.PatternLayout">
      <Pattern>${LOG_PATTERN}</Pattern>
    </layout>
  </appender>

  <springProfile name="local">
    <root level="INFO">
      <appender-ref ref="console_log"/>
    </root>
  </springProfile>

  <springProfile name="prod">
    <root level="INFO">
      <appender-ref ref="aws_cloud_watch_log"/>
    </root>
  </springProfile>
</configuration>